# Spring profile for unified dev environment
# Supports BOTH frontend HTTPS access AND API Gateway HTTP access
# with a SINGLE deployment

# Disable forward-headers-strategy to prevent 308 redirects from API Gateway
# The NGINX ingress will properly set headers for both traffic types
server:
  forward-headers-strategy: none
  tomcat:
    remoteip:
      # Disable protocol header to prevent automatic HTTPS redirect
      protocol-header: ""
      # Keep remote IP header for logging purposes
      remote-ip-header: x-forwarded-for

# Azure redirect URI - uses HTTPS for frontend access
azure:
  launchpad-redirectUri: https://launchpad-auth-dev.hmpps.service.justice.gov.uk/v1/oauth2/callback

# Launchpad issuer URL - uses HTTPS for frontend access
launchpad:
  auth:
    iss-url: https://launchpad-auth-dev.hmpps.service.justice.gov.uk
    id-token-validity-seconds: 300
    access-token-validity-seconds: 600
    refresh-token-validity-seconds: 900

# Use dev environment configurations for external services
hmpps:
  auth:
    url: https://sign-in-dev.hmpps.service.justice.gov.uk/auth
  prison-api:
    url: https://prison-api-dev.prison.service.justice.gov.uk

spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: https://sign-in-dev.hmpps.service.justice.gov.uk/auth/.well-known/jwks.json
      client:
        provider:
          hmpps-auth:
            token-uri: https://sign-in-dev.hmpps.service.justice.gov.uk/auth/oauth/token
  flyway:
    locations: classpath:db/migration/dev

